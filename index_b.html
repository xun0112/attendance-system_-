<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¸‚ç«‹æ–°åŒ—é«˜å·¥ 113-2 è³‡è¨Šç§‘ä¹™ç­ç•™æ ¡é»å</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: #4b5563;
      margin: 0;
    }
.container {
  max-width: 1000px;  /* å¢åŠ å¯¬åº¦ä»¥ç¬¦åˆç”¨æˆ¶åé¥‹ */
  margin: 0 auto;
  padding: 1rem;
  padding-bottom: 2rem;
}
    .card {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      animation: fadeIn 0.5s ease-in;
    }
.attendance {
  font-size: 24px;  /* å¢åŠ è¡¨æƒ…ç¬¦è™Ÿå¤§å° */
  transition: transform 0.2s, color 0.3s;
  cursor: pointer;
  display: inline-block;
}
    .attendance:hover {
      transform: scale(1.2);
    }
    .table-container {
      overflow-x: auto;
    }
table {
  width: 90%;  /* è¨­å®šç‚ºæ­£å¸¸å¯¬åº¦ */
  margin: 0 auto;  /* å±…ä¸­å°é½Š */
  table-layout: auto; /* æ”¹ç‚º autoï¼Œè®“æ ¼å­æ ¹æ“šå…§å®¹è‡ªé©æ‡‰ */
  border-collapse: collapse;
  border-spacing: 0;
}
th, td {
  border: 1px solid #e5e7eb;
  padding: 2px;
  line-height: 1.2;
  text-align: center;
  font-size: 25px;  /* å†æ¬¡å¢åŠ å­—é«”å¤§å° */
  font-weight: bold;  /* ä¿æŒå­—é«”åŠ ç²— */
}
    th {
      background: #eff6ff;
      font-weight: 600;
      color: #1e40af;
    }
    .table-row:hover {
      background: #f1f5f9;
    }
    .btn {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 500;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6);
      color: white;
      transition: transform 0.2s, box-shadow 0.2s;
      display: inline-block;
      text-decoration: none;
    }
    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .btn:active {
      transform: scale(0.95);
    }
    @media (max-width: 640px) {
      body { font-size: 10px; }
      th, td { padding: 2px; }
      .attendance { font-size: 14px; }
      h1 { font-size: 1.25rem; }
      h2 { font-size: 1rem; }
      .btn { padding: 4px 8px; font-size: 10px; }
      .card { padding: 0.75rem; }
      .watermark { font-size: 14px; }
      .capture-watermark { font-size: 14px; }
      .capture-summary { font-size: 12px; }
      .capture-timestamp { font-size: 12px; }
    }
    @media print {
      .no-print { display: none; }
      table { font-size: 8px; }
    }
    .absent-red { color: #dc2626; font-size: 18px; }
    .watermark {
      position: fixed;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-style: italic;
      font-weight: 500;
      color: #1e3a8a;
      opacity: 1.0;
      text-align: center;
      white-space: nowrap;
      z-index: 1000;
    }
    .capture-wrapper {
      position: relative;
      display: inline-block;
      padding-bottom: 100px;
      min-height: 300px;
      background: #ffffff;
      width: 100%;
      text-align: center;
    }
    .capture-container {
      padding: 20px;
      padding-bottom: 20px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 100%;
      display: inline-block;
      text-align: center;
    }
.capture-title {
  font-size: 25px;  /* èª¿æ•´ç‚ºç”¨æˆ¶æŒ‡å®šçš„å°ºå¯¸ */
  font-weight: 600;
  color: #1e40af;
  text-align: center;
  margin-bottom: 8px;
}
.capture-timestamp {
  font-size: 25px;  /* èª¿æ•´ç‚ºä¸€è‡´çš„å¤§å° */
  font-weight: 500;
  color: #1e40af;
  text-align: center;
  margin-bottom: 16px;
}
    .capture-table {
      margin-bottom: 20px;
    }
.capture-table th, .capture-table td {
  border: 1px solid #e5e7eb;
  padding: 6px;
  line-height: 1.5;
  text-align: center;
  font-size: 25px;  /* èª¿æ•´ç‚ºç”¨æˆ¶æŒ‡å®šçš„å°ºå¯¸ */
}
    .capture-table th {
      background: #eff6ff;
      font-weight: 600;
      color: #1e40af;
    }
    .capture-table .text-green-500 { color: #22c55e; font-size: 18px; }
.capture-summary {
  font-size: 25px;  /* èª¿æ•´ç‚ºä¸€è‡´çš„å¤§å° */
  font-weight: 500;
  color: #1e40af;
  text-align: center;
  margin-top: 12px;
  margin-bottom: 20px;
}
    .capture-watermark {
      position: relative;
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-style: italic;
      font-weight: 500;
      color: #1e3a8a;
      opacity: 1.0;
      text-align: center;
      white-space: nowrap;
      background: rgba(255, 255, 255, 0.9);
      padding: 6px 16px;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      margin-top: 20px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .flex {
      display: flex;
    }
    .flex-col {
      flex-direction: column;
    }
    .items-center {
      align-items: center;
    }
    .justify-center {
      justify-content: center;
    }
    .gap-2 {
      gap: 0.5rem;
    }
    .mb-3 {
      margin-bottom: 0.75rem;
    }
    .text-sm {
      font-size: 0.875rem;
    }
    .font-medium {
      font-weight: 500;
    }
    .text-gray-600 {
      color: #4b5563;
    }
    .w-32 {
      width: 8rem;
    }
    .border {
      border-width: 1px;
    }
    .rounded-lg {
      border-radius: 0.5rem;
    }
    .p-1 {
      padding: 0.25rem;
    }
    .flex-wrap {
      flex-wrap: wrap;
    }
    .hidden {
      display: none;
    }
    .text-lg {
      font-size: 1.125rem;
    }
    .font-semibold {
      font-weight: 600;
    }
    .text-blue-900 {
      color: #1e3a8a;
    }
    .text-base {
      font-size: 1rem;
    }
    .text-blue-800 {
      color: #1e40af;
    }
    .mb-2 {
      margin-bottom: 0.5rem;
    }
    .bg-blue-100 {
      background-color: #dbeafe;
    }
    .px-2 {
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }
    .py-1 {
      padding-top: 0.25rem;
      padding-bottom: 0.25rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1 class="text-lg font-semibold text-center text-blue-900 mb-3">å¸‚ç«‹æ–°åŒ—é«˜å·¥ 113-2 è³‡è¨Šç§‘ä¹™ç­ç•™æ ¡é»å</h1>
      
      <div class="flex flex-col items-center mb-3 no-print gap-2">
        <div class="flex items-center gap-2">
          <label for="date-picker" class="text-sm font-medium text-gray-600">é»åæ—¥æœŸï¼š</label>
          <input type="date" id="date-picker" class="border rounded-lg p-1 w-32 text-sm" value="2025-05-14">
        </div>
        <div class="flex flex-wrap justify-center gap-2">
          <button onclick="exportCSV()" class="btn">åŒ¯å‡º CSV</button>
          <button onclick="captureClassA()" class="btn">æˆªåœ–ä¹™ç­åå–®</button>
        </div>
        <div class="flex flex-wrap justify-center gap-2">
          <button onclick="copyToLineClassA()" class="btn">é–‹ LINE ä¹™ç­</button>
        </div>
      </div>
      
      <div class="mb-3 text-gray-600 text-sm text-center no-print">
        <span>åˆ°å ´ï¼š<span id="present-count">0</span></span> | 
        <span>æœªåˆ°ï¼š<span id="absent-count">32</span></span>  <!-- æ›´æ–°ç‚ºæ–°åå–®æ•¸é‡ -->
      </div>

      <h2 class="text-base font-semibold text-blue-800 mb-2">è³‡è¨Šä¸€ä¹™</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ç­ç´š</th>
              <th>åº§è™Ÿ</th>
              <th>å§“å</th>
              <th>åˆ°å ´</th>
            </tr>
          </thead>
          <tbody id="class-a-table">  <!-- ä¿ç•™ id ç‚º class-a-table ä½†å…§å®¹ç‚ºä¹™ç­ -->
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>01</td>
              <td>ç‹éƒæ·³</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>02</td>
              <td>å³æ©æ…ˆ</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>03</td>
              <td>å¼µåº­èª</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>04</td>
              <td>æœ±é¼è±</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>05</td>
              <td>å³æ°æ©</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>06</td>
              <td>æå²³éœ–</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>07</td>
              <td>æ—ä¾‘å‘ˆ</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>08</td>
              <td>æ—å­Ÿæ‰¿</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>09</td>
              <td>æ—å®¥ä¸</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>10</td>
              <td>æ—å»ºä¼</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>11</td>
              <td>æ—æŸé‚‘</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>12</td>
              <td>æ—æ¥·åº­</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>13</td>
              <td>å§šå®šç©</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>14</td>
              <td>ç´€æ‡·æ£®</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>15</td>
              <td>ç¿ç¿å»·</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>16</td>
              <td>é«˜å»·æ°</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>17</td>
              <td>å¼µå‡±å‹›</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>18</td>
              <td>å¼µè³€ç¿”</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>19</td>
              <td>æ¢ç¿”æ™‰</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>20</td>
              <td>è¨±å®¸æ»ˆ</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>21</td>
              <td>é™³å¨å</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>22</td>
              <td>é™³æ”¿å®</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>23</td>
              <td>é™³æŸå‡</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>24</td>
              <td>é™³æŸéŠ“</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>25</td>
              <td>ç«¥å®¥è¯</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>27</td>
              <td>æ¥Šä¸–å‘ˆ</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>29</td>
              <td>æ¥Šæ·®å®‰</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>32</td>
              <td>é„­ç¿°é™½</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>33</td>
              <td>é»æ‰¿éœ–</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>34</td>
              <td>è•­å† å¨</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>35</td>
              <td>è³´æ˜±èª </td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>36</td>
              <td>ç°¡å£«æ‡·</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>37</td>
              <td>ç°¡å®å“²</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
            <tr class="table-row">
              <td>è³‡è¨Šä¸€ä¹™</td>
              <td>38</td>
              <td>é—œåšå£¬</td>
              <td><span class="attendance" onclick="toggleAttendance(this)">â¬œ</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div id="capture-wrapper" class="hidden">
        <div id="capture-container">
          <h2 class="capture-title" id="capture-title"></h2>
          <div class="capture-timestamp" id="capture-timestamp"></div>
          <table class="w-full border-collapse capture-table">
            <thead>
              <tr class="bg-blue-100">
                <th class="border px-2 py-1">ç­ç´š</th>
                <th class="border px-2 py-1">åº§è™Ÿ</th>
                <th class="border px-2 py-1">å§“å</th>
                <th class="border px-2 py-1">åˆ°å ´</th>
              </tr>
            </thead>
            <tbody id="capture-table"></tbody>
          </table>
          <div class="capture-summary" id="capture-summary"></div>
          <div class="capture-watermark">Â© 2025 è¶…æ˜Ÿç³»çµ±ã€‚æ¡ CC BY-NC-ND 4.0 æˆæ¬Šï¼Œç¦æ­¢å•†æ¥­ä½¿ç”¨èˆ‡æ”¹ä½œã€‚</div>
        </div>
      </div>

      <div class="watermark">Â© 2025 è¶…æ˜Ÿç³»çµ±ã€‚æ¡ CC BY-NC-ND 4.0 æˆæ¬Šï¼Œç¦æ­¢å•†æ¥­ä½¿ç”¨èˆ‡æ”¹ä½œã€‚</div>
    </div>
  </div>

  <script>
    const datePicker = document.getElementById('date-picker');
    const classATable = document.getElementById('class-a-table');
    const presentCount = document.getElementById('present-count');
    const absentCount = document.getElementById('absent-count');

    function initializeAttendance() {
      const allSpans = document.querySelectorAll('.attendance');
      allSpans.forEach(span => {
        span.textContent = 'â¬œ';
        span.classList.remove('text-green-500');
      });
      presentCount.textContent = '0';
      absentCount.textContent = allSpans.length;
    }

    function toggleAttendance(element) {
      const isPresent = element.textContent === 'â¬œ';
      element.textContent = isPresent ? 'âœ…' : 'â¬œ';
      element.classList.toggle('text-green-500', isPresent);
      updateStats();
    }

    function updateStats() {
      const allSpans = document.querySelectorAll('.attendance');
      let present = 0;
      allSpans.forEach(span => {
        if (span.textContent === 'âœ…') present++;
      });
      presentCount.textContent = present;
      absentCount.textContent = allSpans.length - present;
    }

    function getCurrentTimestamp() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      return `ç”Ÿæˆæ–¼ ${year}-${month}-${day} ${hours}:${minutes}`;
    }

    function exportCSV() {
      const date = datePicker.value;
      if (!date) {
        alert('è«‹é¸æ“‡é»åæ—¥æœŸï¼');
        return;
      }
      let csv = 'ç­ç´š,åº§è™Ÿ,å§“å,åˆ°å ´\n';
      const rowsA = classATable.querySelectorAll('tr');
      
      rowsA.forEach(row => {
        const cells = row.cells;
        csv += `${cells[0].textContent},${cells[1].textContent},${cells[2].textContent},${cells[3].querySelector('.attendance').textContent === 'âœ…' ? 'âœ…' : 'âŒ'}\n`;
      });
      
      const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `é»å_${date}_ä¹™ç­.csv`;
      link.click();
      alert('CSV å·²åŒ¯å‡ºï¼');
    }

    function captureClassA() {
      const date = datePicker.value;
      if (!date) {
        alert('è«‹é¸æ“‡é»åæ—¥æœŸï¼');
        return;
      }
      const captureWrapper = document.getElementById('capture-wrapper');
      const captureContainer = document.getElementById('capture-container');
      const captureTable = document.getElementById('capture-table');
      const captureTitle = document.getElementById('capture-title');
      const captureTimestamp = document.getElementById('capture-timestamp');
      const captureSummary = document.getElementById('capture-summary');
      captureTable.innerHTML = '';
      captureTitle.textContent = `${date} è³‡è¨Šä¸€ä¹™é»ååå–®`;
      captureTimestamp.textContent = getCurrentTimestamp();
      
      const rowsA = classATable.querySelectorAll('tr');
      let present = 0;
      rowsA.forEach(row => {
        const student = {
          class: row.cells[0].textContent,
          seat: row.cells[1].textContent,
          name: row.cells[2].textContent,
          present: row.cells[3].querySelector('.attendance').textContent === 'âœ…'
        };
        if (student.present) present++;
        const statusClass = student.present ? 'text-green-500' : 'absent-red';
        const statusSymbol = student.present ? 'âœ…' : 'âŒ';
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
          <td class="border px-2 py-1">${student.class}</td>
          <td class="border px-2 py-1">${student.seat}</td>
          <td class="border px-2 py-1">${student.name}</td>
          <td class="border px-2 py-1"><span class="${statusClass}">${statusSymbol}</span></td>
        `;
        captureTable.appendChild(newRow);
      });
      
      captureSummary.textContent = `åˆ°å ´ï¼š${present} äºº | æœªåˆ°ï¼š${rowsA.length - present} äºº`;
      
      captureWrapper.classList.remove('hidden');
      html2canvas(captureWrapper, { scale: 2, backgroundColor: '#ffffff', windowWidth: document.body.scrollWidth, windowHeight: document.body.scrollHeight }).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = `é»ååå–®_${date}_è³‡è¨Šä¸€ä¹™.png`;
        link.click();
        captureWrapper.classList.add('hidden');
        alert('è³‡è¨Šä¸€ä¹™é»ååå–®æˆªåœ–å·²ä¸‹è¼‰ï¼');
      });
    }

    function copyToLineClassA() {
      const date = datePicker.value;
      if (!date) {
        alert('è«‹é¸æ“‡é»åæ—¥æœŸï¼');
        return;
      }
      let text = `ğŸ“‹ ${date} ç•™æ ¡é»å\n`;
      text += `=== è³‡è¨Šä¸€ä¹™ ===\n`;
      const rowsA = classATable.querySelectorAll('tr');
      
      rowsA.forEach(row => {
        const cells = row.cells;
        const status = cells[3].querySelector('.attendance').textContent === 'âœ…' ? 'âœ…' : 'âŒ';
        text += `${cells[2].textContent} (${cells[1].textContent}) ${status}\n`;
      });
      
      let present = 0;
      rowsA.forEach(row => {
        if (row.cells[3].querySelector('.attendance').textContent === 'âœ…') present++;
      });
      text += `\nåˆ°å ´ï¼š${present} äºº | æœªåˆ°ï¼š${rowsA.length - present} äºº`;
      
      navigator.clipboard.writeText(text).then(() => {
        alert('è³‡è¨Šä¸€ä¹™é»åçµæœå·²è¤‡è£½ï¼æ­£åœ¨é–‹å•Ÿ LINE...');
        window.location.href = 'line://';
      }).catch(() => {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ä»¥ä¸‹å…§å®¹ï¼š\n\n' + text);
      });
    }

    initializeAttendance();
  </script>
</body>
</html>
